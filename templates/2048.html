<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>2048</title>
  <style>
    body {
      margin: 0; 
      padding: 0;
      background: #faf8ef;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      width: 100%;
      background: #4CAF50;
      color: #fff;
      text-align: center;
      padding: 10px;
      position: relative;
    }
    .back-button {
      position: absolute;
      left: 10px;
      top: 10px;
      text-decoration: none;
      background: #333;
      color: #fff;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 14px;
    }
    .back-button:hover {
      background: #555;
    }
    h1 {
      margin: 0;
      font-size: 20px;
    }
    #score {
      margin: 10px;
      font-size: 16px;
    }
    #board {
      position: relative;
      width: 340px;
      height: 340px;
      background: #bbada0;
      border-radius: 10px;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-gap: 10px;
    }
    .cell {
      width: 70px; 
      height: 70px;
      background: #ccc0b3;
      border-radius: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 24px;
      color: #776e65;
      transition: transform 0.2s, background 0.2s;
    }

    /* Цвета для разных плиток */
    .cell[data-value="2"]    { background: #eee4da; }
    .cell[data-value="4"]    { background: #ede0c8; }
    .cell[data-value="8"]    { background: #f2b179; color: #f9f6f2; }
    .cell[data-value="16"]   { background: #f59563; color: #f9f6f2; }
    .cell[data-value="32"]   { background: #f67c5f; color: #f9f6f2; }
    .cell[data-value="64"]   { background: #f65e3b; color: #f9f6f2; }
    .cell[data-value="128"]  { background: #edcf72; color: #f9f6f2; }
    .cell[data-value="256"]  { background: #edcc61; color: #f9f6f2; }
    .cell[data-value="512"]  { background: #edc850; color: #f9f6f2; }
    .cell[data-value="1024"] { background: #edc53f; color: #f9f6f2; }
    .cell[data-value="2048"] { background: #edc22e; color: #f9f6f2; }

    @media (max-width: 600px) {
      #board {
        width: 300px;
        height: 300px;
      }
      .cell {
        width: 60px;
        height: 60px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <header>
    <a class="back-button" href="index.html">Назад</a>
    <h1>2048</h1>
  </header>
  
  <div id="score">Очки: <span id="scoreVal">0</span></div>
  <div id="board"></div>

  <script>
    const size = 4;
    let board = [];
    let score = 0;

    const boardElem = document.getElementById("board");
    const scoreVal = document.getElementById("scoreVal");

    function init() {
      board = [];
      for(let i=0; i<size; i++){
        board.push(new Array(size).fill(0));
      }
      score = 0;
      updateScore();

      addNewTile();
      addNewTile();
      drawBoard();
    }

    function drawBoard() {
      boardElem.innerHTML = "";
      for(let r=0; r<size; r++){
        for(let c=0; c<size; c++){
          const val = board[r][c];
          const cell = document.createElement("div");
          cell.classList.add("cell");
          if(val > 0) {
            cell.textContent = val;
            cell.dataset.value = val;
          } else {
            cell.textContent = "";
            cell.dataset.value = 0;
          }
          boardElem.appendChild(cell);
        }
      }
    }

    function addNewTile(){
      let empty = [];
      for(let r=0; r<size; r++){
        for(let c=0; c<size; c++){
          if(board[r][c] === 0) {
            empty.push({r,c});
          }
        }
      }
      if(empty.length === 0) return;
      let randomPos = empty[Math.floor(Math.random()*empty.length)];
      board[randomPos.r][randomPos.c] = (Math.random() < 0.9) ? 2 : 4;
    }

    function updateScore(){
      scoreVal.textContent = score;
    }

    document.addEventListener("keydown", e => {
      let moved = false;
      switch(e.key){
        case "ArrowLeft": moved = moveLeft(); break;
        case "ArrowRight": moved = moveRight(); break;
        case "ArrowUp": moved = moveUp(); break;
        case "ArrowDown": moved = moveDown(); break;
      }
      if (moved) {
        addNewTile();
        drawBoard();
        updateScore();
        checkGameOver();
      }
    });

    function compressRow(row){
      let arr = row.filter(v => v !== 0);
      while(arr.length < size){
        arr.push(0);
      }
      return arr;
    }

    function mergeRow(row){
      for(let i=0; i<size-1; i++){
        if(row[i] !== 0 && row[i] === row[i+1]){
          row[i] *= 2;
          score += row[i];
          row[i+1] = 0;
        }
      }
      return row;
    }

    function moveLeft(){
      let moved = false;
      for(let r=0; r<size; r++){
        let newRow = compressRow(board[r]);
        newRow = mergeRow(newRow);
        newRow = compressRow(newRow);
        if(newRow.some((val, idx) => val !== board[r][idx])) {
          moved = true;
        }
        board[r] = newRow;
      }
      return moved;
    }

    function moveRight(){
      let moved = false;
      for(let r=0; r<size; r++){
        let rev = board[r].slice().reverse();
        rev = compressRow(rev);
        rev = mergeRow(rev);
        rev = compressRow(rev);
        rev.reverse();
        if(rev.some((val, idx) => val !== board[r][idx])) {
          moved = true;
        }
        board[r] = rev;
      }
      return moved;
    }

    function moveUp(){
      let moved = false;
      for(let c=0; c<size; c++){
        let col = [];
        for(let r=0; r<size; r++){
          col.push(board[r][c]);
        }
        let compressed = compressRow(col);
        compressed = mergeRow(compressed);
        compressed = compressRow(compressed);
        for(let r=0; r<size; r++){
          if(board[r][c] !== compressed[r]) moved = true;
          board[r][c] = compressed[r];
        }
      }
      return moved;
    }

    function moveDown(){
      let moved = false;
      for(let c=0; c<size; c++){
        let col = [];
        for(let r=0; r<size; r++){
          col.push(board[r][c]);
        }
        let rev = col.reverse();
        rev = compressRow(rev);
        rev = mergeRow(rev);
        rev = compressRow(rev);
        rev.reverse();
        for(let r=0; r<size; r++){
          if(board[r][c] !== rev[r]) moved = true;
          board[r][c] = rev[r];
        }
      }
      return moved;
    }

    function checkGameOver(){
      // Если нет места и нет ходов — проигрыш
      for(let r=0; r<size; r++){
        for(let c=0; c<size; c++){
          if(board[r][c] === 0) return;
          if(c < size-1 && board[r][c] === board[r][c+1]) return;
          if(r < size-1 && board[r][c] === board[r+1][c]) return;
        }
      }
      alert("Игра окончена! Счёт: " + score);
      init();
    }

    init();
  </script>
</body>
</html>
